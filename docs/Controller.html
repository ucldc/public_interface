<!DOCTYPE html>

<html>
<head>
  <title>Controller.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="ComplexCarouselView.html">
                  ComplexCarouselView.js
                </a>
              
                
                <a class="source" href="ContactOwnerFormView.html">
                  ContactOwnerFormView.js
                </a>
              
                
                <a class="source" href="Controller.html">
                  Controller.js
                </a>
              
                
                <a class="source" href="ExhibitPageView.html">
                  ExhibitPageView.js
                </a>
              
                
                <a class="source" href="FacetFormView.html">
                  FacetFormView.js
                </a>
              
                
                <a class="source" href="GlobalSearchFormView.html">
                  GlobalSearchFormView.js
                </a>
              
                
                <a class="source" href="ItemView.html">
                  ItemView.js
                </a>
              
                
                <a class="source" href="QueryManager.html">
                  QueryManager.js
                </a>
              
                
                <a class="source" href="calisphere-home.html">
                  calisphere-home.js
                </a>
              
                
                <a class="source" href="calisphere.html">
                  calisphere.js
                </a>
              
                
                <a class="source" href="main.html">
                  main.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Controller.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*global ContactOwnerFormView, OpenSeadragon, tileSources, ExhibitPageView, FacetFormView, ItemView, ComplexCarouselView */</span>
<span class="hljs-comment">/*exported setupComponents */</span>
<span class="hljs-meta">
'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="component-controller">Component Controller</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><code>setupComponents()</code> acts as a controller to create/destroy JS components 
based on which selectors are available/no longer available in the DOM.
<code>setupComponents()</code> is called on <code>$(document).ready()</code> and also on <code>pjax:end</code>.
<a href="https://github.com/defunkt/jquery-pjax#events">https://github.com/defunkt/jquery-pjax#events</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> setupComponents = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">globalSearchForm, qm</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><strong>CALISPHERE COMPONENTS</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Calisphere components are subclasses of Backbone.js <code>Backbone.View</code> and 
are attached to the <code>globalSearchForm</code> namespace, an instance of the
<code>GlobalSearchForm</code> component. Their model (where applicable) is <code>qm</code>, an
instance of the <code>QueryManager</code>.</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Calisphere components all have constructors (called using the new 
keyword here) as well as a <code>destroy</code> function. Additionally, each has 
pjax event handlers (bound in that component’s initializer, and unbound 
in <code>destroy</code>), as well as various user-action handlers - click, submit, etc. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#js-facet'</span>).length) {
    globalSearchForm.facetForm = globalSearchForm.facetForm || <span class="hljs-keyword">new</span> FacetFormView({<span class="hljs-attr">model</span>: qm});
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (globalSearchForm.facetForm) {
    globalSearchForm.facetForm.destroy();
    <span class="hljs-keyword">delete</span> globalSearchForm.facetForm;
  }

  <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#js-carouselContainer'</span>).length) {
    globalSearchForm.carousel = globalSearchForm.carousel || <span class="hljs-keyword">new</span> ItemView({<span class="hljs-attr">model</span>: qm});
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (globalSearchForm.carousel) {
    globalSearchForm.carousel.destroy();
    <span class="hljs-keyword">delete</span> globalSearchForm.carousel;
  }

  <span class="hljs-keyword">if</span>($(<span class="hljs-string">'#js-contactOwner'</span>).length) {
    globalSearchForm.contactOwnerForm = globalSearchForm.contactOwnerForm || <span class="hljs-keyword">new</span> ContactOwnerFormView();
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (globalSearchForm.contactOwnerForm) {
    <span class="hljs-keyword">delete</span> globalSearchForm.contactOwnerForm;
  }

  <span class="hljs-keyword">if</span>($(<span class="hljs-string">'.carousel-complex'</span>).length) {
    globalSearchForm.complexCarousel = globalSearchForm.complexCarousel || <span class="hljs-keyword">new</span> ComplexCarouselView({<span class="hljs-attr">model</span>: qm});
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (globalSearchForm.complexCarousel) {
    globalSearchForm.complexCarousel.destroy();
    <span class="hljs-keyword">delete</span> globalSearchForm.complexCarousel;
  }

  <span class="hljs-keyword">if</span>($(<span class="hljs-string">'#js-exhibit-title'</span>).length) {
    globalSearchForm.exhibitPage = globalSearchForm.exhibitPage || <span class="hljs-keyword">new</span> ExhibitPageView();
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (globalSearchForm.exhibitPage) {
    globalSearchForm.exhibitPage.destroy();
    <span class="hljs-keyword">delete</span> globalSearchForm.exhibitPage;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>VENDOR INITIALIZATION</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>These JS components are classes imported from external libraries and 
don’t need their own Calisphere-specific componentry beyond the options
available in their initialization. </p>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>OpenSeadragon Viewer for hosted image content</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>($(<span class="hljs-string">'#obj__osd'</span>).length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Unlike some other components, the viewer leaves behind some cruft, 
so we cannot just reuse the same viewer for different images.
Instead we have to destroy the previous viewer (if one exists), 
and create a new one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(globalSearchForm.viewer) {
      globalSearchForm.viewer.destroy();
      <span class="hljs-keyword">delete</span> globalSearchForm.viewer;
      $(<span class="hljs-string">'#obj__osd'</span>).empty();
    }
    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'.openseadragon-container'</span>).length) { $(<span class="hljs-string">'.openseadragon-container'</span>).remove(); }
    globalSearchForm.viewer = <span class="hljs-keyword">new</span> OpenSeadragon({
      <span class="hljs-attr">id</span>: <span class="hljs-string">'obj__osd'</span>,
      <span class="hljs-attr">toolbar</span>: <span class="hljs-string">'obj__osd-toolbar'</span>,
      <span class="hljs-attr">tileSources</span>: [tileSources],
      <span class="hljs-attr">zoomInButton</span>: <span class="hljs-string">'obj__osd-button-zoom-in'</span>,
      <span class="hljs-attr">zoomOutButton</span>: <span class="hljs-string">'obj__osd-button-zoom-out'</span>,
      <span class="hljs-attr">homeButton</span>: <span class="hljs-string">'obj__osd-button-home'</span>,
      <span class="hljs-attr">fullPageButton</span>: <span class="hljs-string">'obj__osd-button-fullscreen'</span>
    });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>if the viewer exists, but the hosted image content 
selector <code>#obj__osd</code> does not, then just destroy the viewer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (globalSearchForm.viewer) {
    globalSearchForm.viewer.destroy();
    <span class="hljs-keyword">delete</span> globalSearchForm.viewer;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>Isotope Masonry grid for Exhibitions random explore page</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>($(<span class="hljs-string">'#js-exhibit-wrapper'</span>).length) {
    globalSearchForm.grid = $(<span class="hljs-string">'#js-exhibit-wrapper'</span>).isotope({
      <span class="hljs-attr">layoutMode</span>: <span class="hljs-string">'masonry'</span>,
      <span class="hljs-attr">itemSelector</span>: <span class="hljs-string">'.js-grid-item'</span>,
      <span class="hljs-attr">percentPosition</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">masonry</span>: {
        <span class="hljs-attr">columnWidth</span>: <span class="hljs-string">'.js-grid-sizer'</span>
      }
    });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>Text Truncation</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Item page, item title</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="hljs-string">'.obj__heading'</span>).dotdotdot({
    <span class="hljs-attr">ellipsis</span>: <span class="hljs-string">'…'</span>,
    <span class="hljs-attr">watch</span>: <span class="hljs-string">'window'</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">lastCharacter</span>: { <span class="hljs-comment">// remove these characters from the end of the truncated text:</span>
      remove: [ <span class="hljs-string">' '</span>, <span class="hljs-string">','</span>, <span class="hljs-string">';'</span>, <span class="hljs-string">'.'</span>, <span class="hljs-string">'!'</span>, <span class="hljs-string">'?'</span>, <span class="hljs-string">'['</span>, <span class="hljs-string">']'</span> ]
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Search results page, item title</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="hljs-string">'.thumbnail__caption'</span>).dotdotdot({
    <span class="hljs-attr">ellipsis</span>: <span class="hljs-string">'…'</span>,
    <span class="hljs-attr">watch</span>: <span class="hljs-string">'window'</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">lastCharacter</span>: {
      <span class="hljs-attr">remove</span>: [ <span class="hljs-string">' '</span>, <span class="hljs-string">','</span>, <span class="hljs-string">';'</span>, <span class="hljs-string">'.'</span>, <span class="hljs-string">'!'</span>, <span class="hljs-string">'?'</span>, <span class="hljs-string">'['</span>, <span class="hljs-string">']'</span> ]
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Item page, carousel, item title</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(<span class="hljs-string">'.carousel__thumbnail-caption'</span>).dotdotdot({
    <span class="hljs-attr">ellipsis</span>: <span class="hljs-string">'…'</span>,
    <span class="hljs-attr">watch</span>: <span class="hljs-string">'window'</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">lastCharacter</span>: {
      <span class="hljs-attr">remove</span>: [ <span class="hljs-string">' '</span>, <span class="hljs-string">','</span>, <span class="hljs-string">';'</span>, <span class="hljs-string">'.'</span>, <span class="hljs-string">'!'</span>, <span class="hljs-string">'?'</span>, <span class="hljs-string">'['</span>, <span class="hljs-string">']'</span> ]
    }
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>Infinite Scroll on Collection Browse pages</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Collections A-Z, Collections Random Explore, 
and Collections at <institution> Pages</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>($(<span class="hljs-string">'#js-mosaicContainer'</span>).length) {
    $(<span class="hljs-string">'#js-mosaicContainer'</span>).infinitescroll({
      <span class="hljs-attr">navSelector</span>: <span class="hljs-string">'#js-collectionPagination'</span>,
      <span class="hljs-attr">nextSelector</span>: <span class="hljs-string">'#js-collectionPagination a.js-next'</span>,
      <span class="hljs-attr">itemSelector</span>: <span class="hljs-string">'#js-mosaicContainer div.js-collectionMosaic'</span>,
      <span class="hljs-attr">debug</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">loading</span>: {
        <span class="hljs-attr">finishedMsg</span>: <span class="hljs-string">'All collections showing.'</span>,
        <span class="hljs-attr">img</span>: <span class="hljs-string">'//calisphere.org/static_root/images/orange-spinner.gif'</span>,
        <span class="hljs-attr">msgText</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">selector</span>: <span class="hljs-string">'#js-loading'</span>
      }
    });
  }
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
