<!DOCTYPE html>

<html>
<head>
  <title>FacetFormView.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="ComplexCarouselView.html">
                  ComplexCarouselView.js
                </a>
              
                
                <a class="source" href="ContactOwnerFormView.html">
                  ContactOwnerFormView.js
                </a>
              
                
                <a class="source" href="Controller.html">
                  Controller.js
                </a>
              
                
                <a class="source" href="ExhibitPageView.html">
                  ExhibitPageView.js
                </a>
              
                
                <a class="source" href="FacetFormView.html">
                  FacetFormView.js
                </a>
              
                
                <a class="source" href="GlobalSearchFormView.html">
                  GlobalSearchFormView.js
                </a>
              
                
                <a class="source" href="ItemView.html">
                  ItemView.js
                </a>
              
                
                <a class="source" href="QueryManager.html">
                  QueryManager.js
                </a>
              
                
                <a class="source" href="calisphere-home.html">
                  calisphere-home.js
                </a>
              
                
                <a class="source" href="calisphere.html">
                  calisphere.js
                </a>
              
                
                <a class="source" href="main.html">
                  main.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>FacetFormView.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*global Backbone, _ */</span>
<span class="hljs-comment">/*exported FacetFormView */</span>
<span class="hljs-meta">'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Component created if <strong>#js-facet</strong> in DOM<br>templates that include <code>#js-facet</code>: <code>collectionView.html</code>, <code>institutionView.html</code>, <code>institutionViewItems.html</code>, <code>searchResults.html</code>, <code>faceting.html</code>, <code>paginate.html</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> FacetFormView = Backbone.View.extend({
  <span class="hljs-attr">el</span>: $(<span class="hljs-string">'#js-pageContent'</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="user-event-handlers">User Event Handlers</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>These are event handlers for user interaction with the faceting form, 
the search results, and the related collections </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  events: {
    <span class="hljs-string">'submit #js-facet'</span>                        : <span class="hljs-string">'setRefineQuery'</span>,
    <span class="hljs-string">'click .js-refine-filter-pill'</span>            : <span class="hljs-string">'removeRefineQuery'</span>,
    <span class="hljs-string">'change .js-facet'</span>                        : <span class="hljs-string">'setFacet'</span>,
    <span class="hljs-string">'click .js-filter-pill'</span>                   : <span class="hljs-string">'removeFacet'</span>,
    <span class="hljs-string">'click #thumbnails,#list'</span>                 : <span class="hljs-string">'toggleViewFormat'</span>,
    <span class="hljs-string">'change #pag-dropdown__sort'</span>              : <span class="hljs-string">'setSort'</span>,
    <span class="hljs-string">'change #pag-dropdown__view'</span>              : <span class="hljs-string">'setRows'</span>,
    <span class="hljs-string">'click .js-prev,.js-next,a[data-start]'</span>   : <span class="hljs-string">'setStart'</span>,
    <span class="hljs-string">'change .pag-dropdown__select--unstyled'</span>  : <span class="hljs-string">'setStart'</span>,
    <span class="hljs-string">'click .js-item-link'</span>                     : <span class="hljs-string">'goToItemPage'</span>,
    <span class="hljs-string">'click .js-a-check__link-deselect-all'</span>    : <span class="hljs-string">'deselectAll'</span>,
    <span class="hljs-string">'click .js-a-check__button-deselect-all'</span>  : <span class="hljs-string">'deselectAll'</span>,
    <span class="hljs-string">'click .js-a-check__link-select-all'</span>      : <span class="hljs-string">'selectAll'</span>,
    <span class="hljs-string">'click .js-a-check__button-select-all'</span>    : <span class="hljs-string">'selectAll'</span>,
    <span class="hljs-string">'click .js-clear-filters'</span>                 : <span class="hljs-string">'clearFilters'</span>,
    <span class="hljs-string">'click .js-a-check__header'</span>               : <span class="hljs-string">'toggleFacetDropdown'</span>,
    <span class="hljs-string">'click .js-a-check__update'</span>               : <span class="hljs-string">'updateFacets'</span>,
    <span class="hljs-string">'click .js-rc-page'</span>                       : <span class="hljs-string">'paginateRelatedCollections'</span>,
    <span class="hljs-string">'click .js-relatedCollection'</span>             : <span class="hljs-string">'goToCollectionPage'</span>
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><strong>METHODS THAT CHANGE THE QUERY MANAGER</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>These events trigger a change in the model. We donâ€™t actually need to submit
the form here, because the <code>FacetFormView</code> is listening to the model, and
whenever the model changes, the <code>render</code> method is called</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><code>submit</code> triggered on <code>#js-facet</code> (refine button)<br>the refine button is also the submit button for this form (accessibility requires the form have a submit button)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setRefineQuery: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">this</span>.model.set({<span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">rq</span>: $.map($(<span class="hljs-string">'input[name=rq]'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">el</span>) </span>{ <span class="hljs-keyword">return</span> $(el).val(); })});
    e.preventDefault();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-refine-filter-pill</code> (keyword pills, chiclets)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  removeRefineQuery: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> txtFilter = $(e.currentTarget).data(<span class="hljs-string">'slug'</span>);
    $(<span class="hljs-string">'input[form="js-facet"][name="rq"][value="'</span> + txtFilter + <span class="hljs-string">'"]'</span>).val(<span class="hljs-string">''</span>);
    <span class="hljs-keyword">this</span>.model.set({<span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">rq</span>: _.without(<span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'rq'</span>), txtFilter)});
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><code>change</code> triggered on <code>.js-facet</code> (facet checkboxes)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setFacet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> filterType = $(e.currentTarget).attr(<span class="hljs-string">'name'</span>);
    <span class="hljs-keyword">var</span> attributes = {<span class="hljs-attr">start</span>: <span class="hljs-number">0</span>};
    attributes[filterType] = $.map($(<span class="hljs-string">'input[name='</span> + filterType + <span class="hljs-string">']:checked'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">el</span>) </span>{ <span class="hljs-keyword">return</span> $(el).val(); });
    <span class="hljs-keyword">this</span>.model.set(attributes);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-filter-pill</code> (filter pills, chiclets)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  removeFacet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> filter_slug = $(e.currentTarget).data(<span class="hljs-string">'slug'</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> filter_slug !== <span class="hljs-string">'string'</span>) {
      filter_slug = <span class="hljs-built_in">String</span>(filter_slug);
    }
    $(<span class="hljs-string">'#'</span> + filter_slug).prop(<span class="hljs-string">'checked'</span>, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">var</span> filterType = $(<span class="hljs-string">'#'</span> + filter_slug).attr(<span class="hljs-string">'name'</span>);
    <span class="hljs-keyword">var</span> filter = $(<span class="hljs-string">'#'</span> + filter_slug).attr(<span class="hljs-string">'value'</span>);
    <span class="hljs-keyword">var</span> attributes = {<span class="hljs-attr">start</span>: <span class="hljs-number">0</span>};
    attributes[filterType] = _.without(<span class="hljs-keyword">this</span>.model.get(filterType), filter);

    <span class="hljs-keyword">this</span>.model.set(attributes);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>#thumbnails,#list</code> (view format)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toggleViewFormat: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> viewFormat = $(e.currentTarget).attr(<span class="hljs-string">'id'</span>);
    $(<span class="hljs-string">'#view_format'</span>).prop(<span class="hljs-string">'value'</span>, viewFormat);
    <span class="hljs-keyword">this</span>.model.set({<span class="hljs-attr">view_format</span>: viewFormat});
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><code>change</code> triggered on <code>#pag-dropdown__sort</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setSort: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">this</span>.model.set({<span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">sort</span>: $(e.currentTarget).val() });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><code>change</code> triggered on <code>#pag-dropdown__view</code> (pagination)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setRows: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">this</span>.model.set({<span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">rows</span>: $(e.currentTarget).val() });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-prev,.js-next,a[data-start]</code> and
<code>change</code> triggered on <code>#pag-dropdown__select--unstyled</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setStart: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> start;
    <span class="hljs-keyword">if</span> (e.type === <span class="hljs-string">'click'</span>) {
      start = $(e.currentTarget).data(<span class="hljs-string">'start'</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.type === <span class="hljs-string">'change'</span>) {
      start = $(e.currentTarget).children(<span class="hljs-string">'option:selected'</span>).attr(<span class="hljs-string">'value'</span>);
    }
    $(<span class="hljs-string">'#start'</span>).val(start);
    <span class="hljs-keyword">this</span>.model.set({ <span class="hljs-attr">start</span>: start });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>ITEM QUERY MODEL CHANGES</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-item-link</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  goToItemPage: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Middle click, cmd click, and ctrl click should open
links in a new tab as normal.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( e.which &gt; <span class="hljs-number">1</span> || e.metaKey || e.ctrlKey || e.shiftKey || e.altKey ) { <span class="hljs-keyword">return</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><code>itemNumber</code> refers to where the item falls in the current set of search results.
This is used in the carousel, because the 6th item in the search results becomes
the 1st item in the carousel, but when paginating the carousel, we search for the
<code>itemNumber + &lt;number of carousel thumbs displayed&gt;</code> - all searches are offest 
by the <code>itemNumber</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(e.currentTarget).data(<span class="hljs-string">'item_number'</span>) !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">this</span>.model.set({
        <span class="hljs-attr">itemNumber</span>: $(e.currentTarget).data(<span class="hljs-string">'item_number'</span>),
        <span class="hljs-attr">itemId</span>: $(e.currentTarget).data(<span class="hljs-string">'item_id'</span>)
      }, {<span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>});</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>add context for campus, institution, and collection pages
for the â€˜return toâ€™ link above the carousel, and for providing
context for the carousel search</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>($(<span class="hljs-string">'#js-institution'</span>).length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span>($(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'campus'</span>)) {
          <span class="hljs-keyword">this</span>.model.set({
            <span class="hljs-attr">campus_slug</span>: $(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'campus'</span>),
            <span class="hljs-attr">referral</span>: <span class="hljs-string">'campus'</span>,
            <span class="hljs-attr">referralName</span>: $(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'referralname'</span>)
          }, {<span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>});
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">this</span>.model.set({
            <span class="hljs-attr">repository_data</span>: $(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'institution'</span>),
            <span class="hljs-attr">referral</span>: <span class="hljs-string">'institution'</span>,
            <span class="hljs-attr">referralName</span>: $(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'referralname'</span>)
          }, {<span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>});
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#js-collection'</span>).length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.model.set({
          <span class="hljs-attr">collection_data</span>: $(<span class="hljs-string">'#js-collection'</span>).data(<span class="hljs-string">'collection'</span>),
          <span class="hljs-attr">referral</span>: <span class="hljs-string">'collection'</span>,
          <span class="hljs-attr">referralName</span>: $(<span class="hljs-string">'#js-collection'</span>).data(<span class="hljs-string">'referralname'</span>)
        }, {<span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>});
      }

      e.preventDefault();
      $.pjax({
        <span class="hljs-attr">url</span>: $(e.currentTarget).attr(<span class="hljs-string">'href'</span>),
        <span class="hljs-attr">container</span>: <span class="hljs-string">'#js-pageContent'</span>
      });
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong>BULK QUERY MODEL CHANGES</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>These functions select or deselect all facets of a given type 
(type, decade, collection, institutions)</p>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-a-check__link-deselect-all</code> and<br><code>click</code> triggered on <code>.js-a-check__button-deselect-all</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  deselectAll: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{ <span class="hljs-keyword">this</span>.selectDeselectAll(e, <span class="hljs-literal">false</span>); },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-a-check__link-select-all</code> and<br><code>click</code> triggered on <code>.js-a-check__button-select-all</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  selectAll: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{ <span class="hljs-keyword">this</span>.selectDeselectAll(e, <span class="hljs-literal">true</span>); },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>helper for <code>deselectAll</code> and <code>selectAll</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  selectDeselectAll: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, checked</span>) </span>{
    <span class="hljs-keyword">var</span> filterElements = $(e.currentTarget).parents(<span class="hljs-string">'.check'</span>).find(<span class="hljs-string">'.js-facet'</span>);
    filterElements.prop(<span class="hljs-string">'checked'</span>, checked);
    filterElements.trigger(<span class="hljs-string">'change'</span>);
    e.preventDefault();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><strong>CHANGE DISPLAY</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>These methods donâ€™t actually change the model, but change the UI and 
sometimes manually trigger model changes by calling one of the above methods</p>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Helps with the bulk model updater UI. â€˜Select Allâ€™ appears as long as
fewer than the full set of facets is selected. â€˜Deselect Allâ€™ appears
<em>only when all</em> the facets of that type are selected. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toggleSelectDeselectAll: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> facetTypes = $(<span class="hljs-string">'.check'</span>);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;facetTypes.length; i++) {
      <span class="hljs-keyword">var</span> allSelected = !($($(facetTypes[i]).find(<span class="hljs-string">'.js-facet'</span>)).is(<span class="hljs-string">':not(:checked)'</span>));
      <span class="hljs-keyword">if</span> (allSelected === <span class="hljs-literal">true</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>for large screens</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(facetTypes[i]).find(<span class="hljs-string">'.js-a-check__link-deselect-all'</span>).toggleClass(<span class="hljs-string">'check__link-deselect-all--not-selected check__link-deselect-all--selected'</span>);
        $(facetTypes[i]).find(<span class="hljs-string">'.js-a-check__link-select-all'</span>).toggleClass(<span class="hljs-string">'check__link-select-all--selected check__link-select-all--not-selected'</span>);
        $(facetTypes[i]).find(<span class="hljs-string">'.js-a-check__button-select-all'</span>).prop(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">true</span>);
        $(facetTypes[i]).find(<span class="hljs-string">'.js-a-check__update'</span>).prop(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">false</span>);
      }
      <span class="hljs-keyword">var</span> oneSelected = $(facetTypes[i]).find(<span class="hljs-string">'.js-facet'</span>).is(<span class="hljs-string">':checked'</span>);
      <span class="hljs-keyword">if</span> (oneSelected === <span class="hljs-literal">true</span>) {
        $(facetTypes[i]).find(<span class="hljs-string">'.js-a-check__button-deselect-all'</span>).prop(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">false</span>);
      }
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Reset the tooltips</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toggleTooltips: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>get rid of any visible tooltips</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> visibleTooltips = $(<span class="hljs-string">'[data-toggle="tooltip"][aria-describedby]'</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;visibleTooltips.length; i++) {
      <span class="hljs-keyword">var</span> tooltipId = $(visibleTooltips[i]).attr(<span class="hljs-string">'aria-describedby'</span>);
      $(<span class="hljs-string">'#'</span> + tooltipId).remove();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>set tooltips</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'[data-toggle="tooltip"]'</span>).tooltip({
      <span class="hljs-attr">placement</span>: <span class="hljs-string">'top'</span>
    });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-clear-filters</code><br>programmatically clear all filters, and trigger <code>change</code> on <code>.js-facet</code> 
(model change)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  clearFilters: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> filterElements = $(<span class="hljs-string">'.js-facet'</span>);
    filterElements.prop(<span class="hljs-string">'checked'</span>, <span class="hljs-literal">false</span>);
    filterElements.trigger(<span class="hljs-string">'change'</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><strong>MOBILE EVENT HANDLERS</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-a-check__header</code><br>in tablet and mobile, this method opens a list of facets of a given type
(no model update)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toggleFacetDropdown: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>close all expanded checkbox groups</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> allSelected = $(<span class="hljs-string">'.check__popdown--selected'</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;allSelected.length; i++) {
      <span class="hljs-keyword">if</span> ($(allSelected[i]).parent().find(<span class="hljs-string">'input'</span>).attr(<span class="hljs-string">'name'</span>) !== $(e.currentTarget).parent().find(<span class="hljs-string">'input'</span>).attr(<span class="hljs-string">'name'</span>)) {
        $(allSelected[i]).toggleClass(<span class="hljs-string">'check__popdown check__popdown--selected'</span>);
        $(allSelected[i]).prev(<span class="hljs-string">'.js-a-check__header'</span>).children(<span class="hljs-string">'.js-a-check__header-arrow-icon'</span>).toggleClass(<span class="hljs-string">'fa-angle-down fa-angle-up'</span>);
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>open this checkbox group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(e.currentTarget).next(<span class="hljs-string">'.js-a-check__popdown'</span>).toggleClass(<span class="hljs-string">'check__popdown check__popdown--selected'</span>);
    $(e.currentTarget).children(<span class="hljs-string">'.js-a-check__header-arrow-icon'</span>).toggleClass(<span class="hljs-string">'fa-angle-down fa-angle-up'</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-a-check__update</code><br>in tablet and mobile, the update button is essentially the same as 
kicking off a search</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  updateFacets: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    e.preventDefault();
    <span class="hljs-keyword">this</span>.facetSearch();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><strong>PJAX CALL TO PERFORM THE SEARCH</strong> </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  facetSearch: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    $.pjax({
      <span class="hljs-attr">url</span>: $(<span class="hljs-string">'#js-facet'</span>).attr(<span class="hljs-string">'action'</span>),
      <span class="hljs-attr">container</span>: <span class="hljs-string">'#js-pageContent'</span>,
      <span class="hljs-attr">data</span>: <span class="hljs-keyword">this</span>.model.toJSON(),
      <span class="hljs-attr">traditional</span>: <span class="hljs-literal">true</span>
    });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><strong>RELATED COLLECTIONS</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>These methods deal with the related collections seen below search results</p>

            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-rc-page</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  paginateRelatedCollections: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>implicitly set institution, campus, and collection data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>($(<span class="hljs-string">'#js-institution'</span>).length &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span>($(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'campus'</span>)) {
        <span class="hljs-keyword">this</span>.model.set({
          <span class="hljs-attr">campus_slug</span>: $(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'campus'</span>),
          <span class="hljs-attr">referral</span>: <span class="hljs-string">'campus'</span>,
          <span class="hljs-attr">referralName</span>: $(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'referralname'</span>)
        }, {<span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>});
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.model.set({
          <span class="hljs-attr">repository_data</span>: $(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'institution'</span>),
          <span class="hljs-attr">referral</span>: <span class="hljs-string">'institution'</span>,
          <span class="hljs-attr">referralName</span>: $(<span class="hljs-string">'#js-institution'</span>).data(<span class="hljs-string">'referralname'</span>)
        }, {<span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>});
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#js-collection'</span>).length &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.model.set({
        <span class="hljs-attr">collection_data</span>: $(<span class="hljs-string">'#js-collection'</span>).data(<span class="hljs-string">'collection'</span>),
        <span class="hljs-attr">referral</span>: <span class="hljs-string">'collection'</span>,
        <span class="hljs-attr">referralName</span>: $(<span class="hljs-string">'#js-collection'</span>).data(<span class="hljs-string">'referralname'</span>)
      }, {<span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>});
    }

    <span class="hljs-keyword">var</span> data_params = <span class="hljs-keyword">this</span>.model.toJSON();
    data_params.rc_page = $(e.currentTarget).data(<span class="hljs-string">'rc_page'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>simple AJAX method called here - we donâ€™t update the URL
as we paginate related collections</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.ajax({<span class="hljs-attr">data</span>: data_params, <span class="hljs-attr">traditional</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">'/relatedCollections/'</span>, <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        $(<span class="hljs-string">'#js-relatedCollections'</span>).html(data);
      }
    });
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><code>click</code> triggered on <code>.js-relatedCollection</code><br>when a user navigates away from a search results page to a collection page
via related collections, they lose their search context.<br>this is where it goes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  goToCollectionPage: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.model.clear({<span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>});
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h2 id="window-resize-tracking">WINDOW RESIZE TRACKING</h2>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>change value of this.desktop to redraw this page when it changes widths</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  changeWidth: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">window_width</span>) </span>{
    <span class="hljs-keyword">if</span> (window_width &gt; <span class="hljs-number">900</span>) { <span class="hljs-keyword">this</span>.desktop = <span class="hljs-literal">true</span>; }
    <span class="hljs-keyword">else</span> { <span class="hljs-keyword">this</span>.desktop = <span class="hljs-literal">false</span>; }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <h2 id="render-method">RENDER METHOD</h2>

            </div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>called whenever the model changes, and also on initialization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>if the model has changed, but the primary query hasnâ€™t.
ie: a search for dogs hasnâ€™t become a search for cats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(!_.isEmpty(<span class="hljs-keyword">this</span>.model.changed) &amp;&amp; !_.has(<span class="hljs-keyword">this</span>.model.changed, <span class="hljs-string">'q'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>if weâ€™re in desktop view, just perform the search</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.desktop) {
        <span class="hljs-keyword">this</span>.facetSearch();
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>if weâ€™re in mobile view, and a facet selection has changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_.has(<span class="hljs-keyword">this</span>.model.changed, <span class="hljs-string">'type_ss'</span>) ||
      _.has(<span class="hljs-keyword">this</span>.model.changed, <span class="hljs-string">'facet_decade'</span>) ||
      _.has(<span class="hljs-keyword">this</span>.model.changed, <span class="hljs-string">'repository_data'</span>) ||
      _.has(<span class="hljs-keyword">this</span>.model.changed, <span class="hljs-string">'collection_data'</span>)) {
        <span class="hljs-keyword">var</span> attrUndefined = <span class="hljs-literal">false</span>;
        _.each(<span class="hljs-keyword">this</span>.model.changed, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
          <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span>) {
            attrUndefined = <span class="hljs-literal">true</span>;
          }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>if the user has un-checked a previously selected facet, perform search</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (attrUndefined) {
          <span class="hljs-keyword">this</span>.facetSearch();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>modify the UI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _.each(<span class="hljs-keyword">this</span>.model.changed, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, key</span>) </span>{
          <span class="hljs-keyword">if</span> (key === <span class="hljs-string">'type_ss'</span> || key === <span class="hljs-string">'facet_decade'</span> || key === <span class="hljs-string">'repository_data'</span> || key === <span class="hljs-string">'collection_data'</span>) {
            $(<span class="hljs-string">'.facet-'</span> + key).parents(<span class="hljs-string">'.check'</span>).find(<span class="hljs-string">'.js-a-check__update'</span>).prop(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">false</span>);
          }
        });
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>just perform the search</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.facetSearch();
      }
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <h2 id="pjax-event-handlers">PJAX EVENT HANDLERS</h2>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>called on <code>pjax:end</code>, only when a <code>FacetFormView</code> already exists
so the user has already visited a search results page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pjax_end: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">that</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>since this is still called on pjax:end when navigating away from 
the facet form to something else, we need to check for our
<code>#js-facet</code> selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#js-facet'</span>).length) {
        <span class="hljs-keyword">if</span> (that.popstate === <span class="hljs-string">'back'</span> || that.popstate === <span class="hljs-string">'forward'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>when a user navigates â€˜backâ€™ to a form, the form is still set
in the state the user left the form in, which doesnâ€™t reflect
the results shown in search results, so we reset the form
to reflect the state the DOM left the form in, last we got a 
roundtrip from the server. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          _.each($(<span class="hljs-string">'form'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">form</span>) </span>{
            form.reset();
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>get the query from the DOM, and silently set the model so as 
to avoid calling <code>render</code> - (no need to redraw the page; the 
page has already been drawn)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> queryObj;
          queryObj = that.model.getQueryFromDOM(<span class="hljs-string">'js-facet'</span>);
          that.model.set(queryObj, {<span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>});
          that.popstate = <span class="hljs-literal">null</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>we do need to redraw the tooltips and the select/deselect all 
buttons to reflect the current query state, though</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        that.toggleSelectDeselectAll();
        that.toggleTooltips();
      }
    };
  },

  <span class="hljs-attr">pjax_popstate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">that</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
      that.popstate = e.direction;
    };
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>called via <code>setupComponents()</code> on <code>document.ready()</code> and <code>pjax:end</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>sets <code>this.render</code> to listen to whenever <code>this.model</code> (qm) fires a <code>change</code> event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>.render);</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>draw the page up correctly when initialized</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.changeWidth($(<span class="hljs-built_in">window</span>).width());</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>draw the tooltips and select/deselect all buttons correctly - this
happens both on initialization and on pjax:end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.toggleSelectDeselectAll();
    <span class="hljs-keyword">this</span>.toggleTooltips();</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>bind pjax handlers to <code>this</code><br>we need to save the bound handler to <code>this.bound_pjax_end</code> so we can 
later remove these handlers by the same name in <code>destroy</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.bound_pjax_end = <span class="hljs-keyword">this</span>.pjax_end(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.bound_pjax_popstate = <span class="hljs-keyword">this</span>.pjax_popstate(<span class="hljs-keyword">this</span>);
    $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">'pjax:end'</span>, <span class="hljs-string">'#js-pageContent'</span>, <span class="hljs-keyword">this</span>.bound_pjax_end);
    $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">'pjax:popstate'</span>, <span class="hljs-string">'#js-pageContent'</span>, <span class="hljs-keyword">this</span>.bound_pjax_popstate);
  },

  <span class="hljs-attr">destroy</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>remove bound pjax event handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">'pjax:end'</span>, <span class="hljs-string">'#js-pageContent'</span>, <span class="hljs-keyword">this</span>.bound_pjax_end);
    $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">'pjax:popstate'</span>, <span class="hljs-string">'#js-pageContent'</span>, <span class="hljs-keyword">this</span>.bound_pjax_popstate);</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>stop calling <code>this.render</code> whenever <code>this.model</code> (qm) fires a <code>change</code> event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.stopListening();</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>undelegate all user event handlers specified in <code>this.events</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.undelegateEvents();
  }
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
